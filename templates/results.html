<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Crawl Results - Website Crawler</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/results.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/enhancements.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/page_power.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
</head>
<body>
    <div class="container">
        <header class="results-header">
            <div class="header-content">
                <div class="header-left">
                    <a href="/" class="back-button">
                        <i class="fas fa-arrow-left"></i>
                    </a>
                    <h1><i class="fas fa-chart-bar"></i> Crawl Results</h1>
                </div>
            </div>
        </header>

        <main>
            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card" onclick="showSection('overview')">
                    <div class="card-icon blue">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="totalPages">0</h3>
                        <p>Pages Crawled</p>
                    </div>
                </div>
                <div class="summary-card" onclick="showSection('broken-links')">
                    <div class="card-icon red">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="brokenLinks">0</h3>
                        <p>Broken Links</p>
                    </div>
                </div>
                <div class="summary-card" onclick="showSection('duplicates')">
                    <div class="card-icon orange">
                        <i class="fas fa-copy"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="duplicatePages">0</h3>
                        <p>Duplicate Pages</p>
                    </div>
                </div>
                <div class="summary-card" onclick="showSection('similarity')">
                    <div class="card-icon purple">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="similarPages">0</h3>
                        <p>Similar Content</p>
                    </div>
                </div>
                <div class="summary-card" onclick="showSection('external-links')">
                    <div class="card-icon green">
                        <i class="fas fa-external-link-alt"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="externalLinksTotal">0</h3>
                        <p>External Links</p>
                    </div>
                </div>
                <div class="summary-card" onclick="showSection('advanced-seo')">
                    <div class="card-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="card-content">
                        <h3 id="siteSeoScore">-</h3>
                        <p>SEO Audit Score</p>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="tabs">
                <button class="tab-btn active" onclick="showSection('overview')">
                    <i class="fas fa-list"></i> Overview
                </button>
                <button class="tab-btn" onclick="showSection('broken-links')">
                    <i class="fas fa-unlink"></i> Broken Links
                </button>
                <button class="tab-btn" onclick="showSection('duplicates')">
                    <i class="fas fa-copy"></i> Duplicates
                </button>
                <button class="tab-btn" onclick="showSection('similarity')">
                    <i class="fas fa-project-diagram"></i> Similarity
                </button>
                <button class="tab-btn" onclick="showSection('external-links')">
                    <i class="fas fa-external-link-alt"></i> External Links
                </button>
                <button class="tab-btn" onclick="showSection('meta-seo')">
                    <i class="fas fa-code"></i> Meta & SEO
                </button>
                <button class="tab-btn" onclick="showSection('image-analyzer')">
                    <i class="fas fa-image"></i> Image Analyzer
                </button>
                <button class="tab-btn" onclick="showSection('keywords')">
                    <i class="fas fa-key"></i> Keywords
                </button>
                <button class="tab-btn" onclick="showSection('keyword-search')">
                    <i class="fas fa-search"></i> Keyword Search
                </button>
                <button class="tab-btn" onclick="showSection('statistics')">
                    <i class="fas fa-chart-pie"></i> Statistics
                </button>
                <button class="tab-btn" onclick="showSection('performance')">
                    <i class="fas fa-tachometer-alt"></i> Performance
                </button>
                <button class="tab-btn" onclick="showSection('orphan-pages')">
                    <i class="fas fa-unlink"></i> Orphan Pages
                </button>
                <button class="tab-btn" onclick="showSection('page-power')">
                    <i class="fas fa-bolt"></i> Page Power
                </button>
                <button class="tab-btn" onclick="showSection('advanced-seo')">
                    <i class="fas fa-clipboard-check"></i> Advanced SEO Audit
                </button>
                <button class="tab-btn" onclick="showSection('dom-analysis')">
                    <i class="fas fa-sitemap"></i> DOM Analysis
                </button>
            </div>

            <!-- Overview Section -->
            <section id="overview-section" class="content-section active">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-list"></i> All Pages</h2>
                        <div class="section-actions">
                            <input type="text" id="searchInput" placeholder="Search URLs..." class="search-box">
                            <select id="duplicateFilter" class="filter-select">
                                <option value="all">All Pages</option>
                                <option value="duplicate">Duplicates Only</option>
                                <option value="unique">Unique Only</option>
                            </select>
                            <select id="statusFilter" class="filter-select">
                                <option value="all">All Status</option>
                                <option value="200">200 OK</option>
                                <option value="404">404 Not Found</option>
                                <option value="error">Errors</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="resultsTable">
                            <thead>
                                <tr>
                                    <th>URL</th>
                                    <th>Status</th>
                                    <th>Title</th>
                                    <th>Word Count</th>
                                    <th>Duplicate</th>
                                    <th>Similarity</th>
                                    <th>Page Power</th>
                                    <th>Broken Links</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <tr>
                                    <td colspan="8" class="loading">Loading results...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Broken Links Section -->
            <section id="broken-links-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-unlink"></i> Broken Links</h2>
                        <span class="badge badge-danger" id="brokenLinksCount">0 found</span>
                    </div>
                    <div id="brokenLinksContainer">
                        <p class="loading">Loading broken links...</p>
                    </div>
                </div>
            </section>

            <!-- Duplicates Section -->
            <section id="duplicates-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-copy"></i> Duplicate Pages</h2>
                        <span class="badge badge-warning" id="duplicatesCount">0 groups</span>
                    </div>
                    <div id="duplicatesContainer">
                        <p class="loading">Loading duplicates...</p>
                    </div>
                </div>
            </section>

            <!-- Similarity Section -->
            <section id="similarity-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-project-diagram"></i> Content Similarity</h2>
                        <span class="badge badge-info" id="similarityCount">0 pairs</span>
                    </div>
                    <div id="similarityContainer">
                        <p class="loading">Loading similarity data...</p>
                    </div>
                </div>
            </section>

            <!-- External Links Section -->
            <section id="external-links-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-external-link-alt"></i> External Links</h2>
                        <span class="badge badge-info" id="externalLinksCount">0 links</span>
                    </div>
                    <div class="section-actions" style="margin-bottom: 16px;">
                        <input type="text" id="externalSearchInput" placeholder="Search external links..." class="search-box">
                        <select id="externalPageFilter" class="filter-select">
                            <option value="all">All Pages</option>
                        </select>
                    </div>
                    <div id="externalLinksContainer">
                        <p class="loading">Loading external links...</p>
                    </div>
                </div>
            </section>

            <!-- Statistics Section -->
            <section id="statistics-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-chart-pie"></i> Statistics & Analytics</h2>
                    </div>
                    <div class="charts-container">
                        <div class="chart-card">
                            <h3>Status Code Distribution</h3>
                            <canvas id="statusChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Word Count Distribution</h3>
                            <canvas id="wordCountChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Duplicate Status</h3>
                            <canvas id="duplicateChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Similarity Distribution</h3>
                            <canvas id="similarityChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Performance Analysis Section -->
            <section id="performance-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <div>
                            <h2><i class="fas fa-tachometer-alt"></i> Performance Analysis</h2>
                            <p class="section-description">Detect slow-loading elements and performance bottlenecks</p>
                        </div>
                        <div class="section-actions">
                            <select id="performancePageFilter" class="filter-select">
                                <option value="all">All Pages</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Performance Summary Stats -->
                    <div class="performance-summary" id="performanceSummary" style="display: none;">
                        <div class="performance-summary-item">
                            <span class="summary-value" id="summaryHeavyImages">0</span>
                            <span class="summary-label">Heavy Images</span>
                        </div>
                        <div class="performance-summary-item">
                            <span class="summary-value" id="summarySlowFiles">0</span>
                            <span class="summary-label">Slow JS/CSS</span>
                        </div>
                        <div class="performance-summary-item">
                            <span class="summary-value" id="summarySlowSections">0</span>
                            <span class="summary-label">Slow Sections</span>
                        </div>
                        <div class="performance-summary-item">
                            <span class="summary-value" id="summarySlowComponents">0</span>
                            <span class="summary-label">Slow Components</span>
                        </div>
                        <div class="performance-summary-item">
                            <span class="summary-value" id="summaryRenderBlocking">0</span>
                            <span class="summary-label">Render-Blocking</span>
                        </div>
                    </div>
                    
                    <div class="performance-grid">
                        <div class="performance-column">
                            <h3><i class="fas fa-image"></i> Heavy Images</h3>
                            <div id="heavyImagesContainer">
                                <p class="loading">Analyzing images...</p>
                            </div>
                        </div>
                        <div class="performance-column">
                            <h3><i class="fas fa-file-code"></i> Slow JS/CSS Files</h3>
                            <div id="slowJsCssContainer">
                                <p class="loading">Analyzing resources...</p>
                            </div>
                        </div>
                        <div class="performance-column">
                            <h3><i class="fas fa-code"></i> Slow HTML Sections</h3>
                            <div id="slowHtmlSectionsContainer">
                                <p class="loading">Analyzing structure...</p>
                            </div>
                        </div>
                        <div class="performance-column">
                            <h3><i class="fas fa-puzzle-piece"></i> Slow Components</h3>
                            <div id="slowComponentsContainer">
                                <p class="loading">Analyzing components...</p>
                            </div>
                        </div>
                        <div class="performance-column full-width">
                            <h3><i class="fas fa-ban"></i> Render-Blocking Resources</h3>
                            <div id="renderBlockingContainer">
                                <p class="loading">Checking render-blocking resources...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Image Analyzer Section -->
            <section id="image-analyzer-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-image"></i> Image Analyzer</h2>
                    </div>
                    <div class="image-analyzer-grid">
                        <div class="image-analyzer-column">
                            <h3>Missing ALT Text</h3>
                            <div id="missingAltContainer">
                                <p class="loading">Analyzing images for missing ALT text...</p>
                            </div>
                        </div>
                        <div class="image-analyzer-column">
                            <h3>Large Images (Possible Unoptimized)</h3>
                            <div id="largeImagesContainer">
                                <p class="loading">Checking image sizes...</p>
                            </div>
                        </div>
                        <div class="image-analyzer-column">
                            <h3>Duplicate Images Across Pages</h3>
                            <div id="duplicateImagesContainer">
                                <p class="loading">Finding duplicate image usage...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Meta & On-Page SEO Section -->
            <section id="meta-seo-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-code"></i> Meta & On-Page SEO</h2>
                    </div>
                    <div class="section-actions">
                        <select id="metaIssueFilter" class="filter-select">
                            <option value="all">All Pages</option>
                            <option value="missing-title">Missing / Short Title</option>
                            <option value="long-title">Title Too Long</option>
                            <option value="missing-description">Missing Description</option>
                            <option value="long-description">Description Too Long</option>
                            <option value="missing-canonical">Missing Canonical</option>
                            <option value="missing-og">Missing OG Tags</option>
                            <option value="missing-twitter">Missing Twitter Tags</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table id="metaSeoTable">
                            <thead>
                                <tr>
                                    <th>Page</th>
                                    <th>Title Length</th>
                                    <th>Description Length</th>
                                    <th>Canon.</th>
                                    <th>H1 / H2 / H3</th>
                                    <th>OG Tags</th>
                                    <th>Twitter Tags</th>
                                </tr>
                            </thead>
                            <tbody id="metaSeoTableBody">
                                <tr>
                                    <td colspan="7" class="loading">Analyzing meta tags and headings...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Keywords Section -->
            <section id="keywords-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-key"></i> Keyword Analysis</h2>
                    </div>
                    <div class="section-actions">
                        <input type="text" id="keywordSearchInput" placeholder="Search keywords..." class="search-box">
                        <select id="keywordPageFilter" class="filter-select">
                            <option value="all">All Pages</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table id="keywordsTable">
                            <thead>
                                <tr>
                                    <th>Keyword</th>
                                    <th>Pages Using It</th>
                                    <th>Total Count</th>
                                    <th>IDF</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="keywordsTableBody">
                                <tr>
                                    <td colspan="5" class="loading">Loading keyword analysis...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Keyword Search Section -->
            <section id="keyword-search-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-search"></i> Keyword Search per Page</h2>
                    </div>
                    <div class="section-actions">
                        <input type="text" id="keywordSearchTermInput" placeholder="Enter keyword (e.g. longhorn)" class="search-box">
                        <button id="keywordSearchBtn" class="btn btn-primary">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                    <div class="table-container">
                        <table id="keywordSearchTable">
                            <thead>
                                <tr>
                                    <th>Page</th>
                                    <th>Keyword Count</th>
                                    <th>Word Count</th>
                                    <th>% of Words</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="keywordSearchTableBody">
                                <tr>
                                    <td colspan="5" class="loading">Enter a keyword above and click Search.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Page Power Section -->
            <section id="page-power-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-bolt"></i> Page Power Analysis</h2>
                    </div>
                    
                    <!-- Page Power Description -->
                    <div class="page-power-description">
                        <div class="info-box">
                            <h3><i class="fas fa-info-circle"></i> What is Page Power?</h3>
                            <p><strong>Page Power</strong> is a metric that measures the prominence and authority of pages within your website based on internal linking patterns. Similar to Google's PageRank algorithm, it calculates how influential each page is by analyzing:</p>
                            <ul>
                                <li><strong>Incoming Links:</strong> Pages with more internal links pointing to them receive higher power</li>
                                <li><strong>Link Quality:</strong> Links from high-power pages contribute more value than links from low-power pages</li>
                                <li><strong>Link Distribution:</strong> Pages that distribute their power to fewer pages pass more value</li>
                                <li><strong>Homepage Boost:</strong> The homepage typically has the highest power as the entry point</li>
                            </ul>
                            <p><strong>Why it matters:</strong> Pages with higher Page Power are more likely to be discovered by search engines and users, receive more link equity, and can help boost the visibility of pages they link to. Understanding your site's Page Power distribution helps you optimize internal linking structure for better SEO performance.</p>
                        </div>
                    </div>
                    
                    <div id="pagePowerContainer">
                        <p class="loading">Loading page power analysis...</p>
                    </div>
                </div>
            </section>

            <!-- Advanced SEO Audit Section -->
            <section id="advanced-seo-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-clipboard-check"></i> Advanced SEO Audit</h2>
                        <p class="section-description">Comprehensive on-page SEO analysis with detailed recommendations</p>
                    </div>
                    <div id="advancedSeoContainer">
                        <p class="loading">Loading advanced SEO audit...</p>
                    </div>
                </div>
            </section>

            <!-- DOM Analysis Section -->
            <section id="dom-analysis-section" class="content-section">
                <div class="card">
                    <div class="section-header">
                        <h2><i class="fas fa-sitemap"></i> DOM Analysis</h2>
                        <p class="section-description">DOM structure complexity and performance analysis</p>
                    </div>
                    <div id="domAnalysisContainer">
                        <p class="loading">Loading DOM analysis...</p>
                    </div>
                </div>
            </section>

            <!-- Download Actions -->
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-download"></i> Export Reports</h2>
                </div>
                <div class="download-actions">
                    <button id="downloadJsonBtn" class="btn btn-primary">
                        <i class="fas fa-download"></i> Download JSON Report
                    </button>
                    <button id="downloadCsvBtn" class="btn btn-primary">
                        <i class="fas fa-download"></i> Download CSV Summary
                    </button>
                    <button id="downloadSitemapBtn" class="btn btn-primary">
                        <i class="fas fa-download"></i> Download Sitemap
                    </button>
                    <button id="exportReportBtn" class="btn btn-success">
                        <i class="fas fa-file-pdf"></i> Export Full Report
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Page Detail Modal -->
    <div id="pageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Page Details</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Similar Content Modal -->
    <div id="similarContentModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2><i class="fas fa-copy"></i> Similar Content Comparison</h2>
                <span class="close" onclick="closeSimilarContentModal()">&times;</span>
            </div>
            <div class="modal-body" id="similarContentModalBody">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Keyword Details Modal -->
    <div id="keywordModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="keywordModalTitle"><i class="fas fa-key"></i> Keyword Details</h2>
                <span class="close" onclick="closeKeywordModal()">&times;</span>
            </div>
            <div class="modal-body" id="keywordModalBody">
                <!-- Keyword details will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        const jobId = '{{ job_id }}';
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            const keywordModal = document.getElementById('keywordModal');
            const pageModal = document.getElementById('pageModal');
            const similarContentModal = document.getElementById('similarContentModal');
            
            if (keywordModal && event.target === keywordModal) {
                closeKeywordModal();
            }
            if (pageModal && event.target === pageModal) {
                if (typeof closeModal === 'function') {
                    closeModal();
                } else {
                    pageModal.style.display = 'none';
                }
            }
            if (similarContentModal && event.target === similarContentModal) {
                if (typeof closeSimilarContentModal === 'function') {
                    closeSimilarContentModal();
                } else {
                    similarContentModal.style.display = 'none';
                }
            }
        };
    </script>
    <script src="{{ url_for('static', filename='js/results.js') }}"></script>
</body>
</html>
